<ion-header>
  <nl-modal-navbar [title]="headerTitle" [complaint]="null"></nl-modal-navbar>
</ion-header>
<ion-content id="chat" class="csChatBox csGrayBackground">
  <ion-item class="csShadow" *ngIf="show" no-lines>
    <div>    
      <ion-item no-lines text-center>
        <b>{{conversation.title}}</b>
      </ion-item>
      <ion-item>
        <ion-icon name="apps" class="icon-color4" item-left></ion-icon>
        <b>Category:</b>
        <span item-right>{{conversation.categoryName}}</span>
      </ion-item>   
      <ion-item>
        <ion-icon name="barcode" class="icon-color5" item-left></ion-icon>
        <b>Status: </b>
        <span item-right>{{conversation.isClosed ? "Closed" : "Open"}}</span>
      </ion-item>   
      <ion-item>
        <ion-icon name="clock" class="icon-color1" item-left></ion-icon>
        <b>Created Date:</b>
        <span item-right>{{conversation.createdAt | amDateFormat: 'DD/MM/YYYY' }}</span>
      </ion-item>
      <ion-item *ngIf="conversation.closedOn" no-lines>
        <ion-icon name="clock" class="icon-color3" item-left></ion-icon>
        <b>Closed Date:</b>
        <span item-right>{{conversation.closedOn | amDateFormat: 'DD/MM/YYYY' }}</span>
      </ion-item>              
    </div>
    <br>
    <div>
      <b>Category:</b> {{conversation.categoryName}}
      <span class="csRight"><b>Status: </b>{{conversation.isClosed ? "Closed" : "Open"}}</span>
    </div>
    <br>
    <div>
      <b>Created at: </b>{{conversation.createdAt | amDateFormat: 'DD/MM/YYYY' }}
      <span class="csRight" *ngIf="conversation.closedOn"><b>Closed at:</b> {{conversation.closedOn | amDateFormat: 'DD/MM/YYYY' }}</span>
    </div>
  </ion-item>
  <button ion-button clear full (click)="show = !show" icon-left>
    <ion-icon *ngIf="show" name="eye-off"></ion-icon>
    <ion-icon *ngIf="!show" name="eye"></ion-icon>
    <span *ngIf="show">Hide Details</span>
    <span *ngIf="!show">Show Details</span>
  </button>

  <ion-refresher (ionRefresh)="onPullOldMessages($event)">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>
  <div class="message-box csTransparent" *ngFor="let m of messages" [ngClass]="{'mine': m.parentName != null}" no-margin>
    <div class="csMyComment">
      <h3 *ngIf="!m.fileName">{{ m.message }}</h3>
      <img *ngIf="m.fileName" [src]="baseUrl + m.message">
    </div>
    <!--<img class="csChatImage avt" *ngIf="m.parentName != null" src="http://footage.framepool.com/shotimg/608711393-dibujo-papel-escolar-aula-de-clases.jpg">-->
    <div class="csCommentTime">{{m.employeeName}} {{ m.createdAt | amCalendar }}</div>
  </div>
  <ion-spinner class="loader" name="dots" *ngIf="!notPost"></ion-spinner>
</ion-content>
<ion-footer keyboard-attach class="bar-stable csFooterColor" #commentBtn *ngIf="!isClosed">
  <form class="comment-box" [formGroup]="commentForm" novalidate>
    <ion-grid>
      <ion-row>
        <!--<ion-fab left bottom (click)="openImageActionSheet()">
          <button style="border:2px solid white" ion-fab color="cool" mini>
            <ion-icon name="attach" ></ion-icon>
          </button>
        </ion-fab>-->
        <ion-textarea rows="2" class="csCommentInput csMessageText" type="text" formControlName="message" placeholder="Write message...">
        </ion-textarea>
        <ion-fab right bottom (click)="postMessage()">
          <button style="border:2px solid white" ion-fab color="cool" mini [disabled]="commentForm.invalid || !notPost">
            <ion-icon name="md-send" ></ion-icon>
          </button>
        </ion-fab>
      </ion-row>
    </ion-grid>
  </form>
</ion-footer>
